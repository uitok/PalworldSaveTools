import{g as ue,b as ye}from"../chunks/B7z-6CDi.js";import{l as oe,b as re,p as n,i as R,c as $}from"../chunks/woX702LQ.js";import{e as B,g as H,h as d,p as Z,f as P,c as U,r as b,t as z,j as Q,B as ae,b as C,i as M,u as V,aq as Ae,k as be,z as xe,l as Le,J as He}from"../chunks/B9aKyTE9.js";import{f as Oe,b as J,g as Ie,a as Ge,t as Ne,h as ke}from"../chunks/DPqr1Em3.js";import{I as ie,b as ce,a1 as fe,g as x,P as Me,l as Ee,af as Be,e as me,M as c,ag as Fe,ah as Re,a as A,h as $e,ai as je,Y as we,w as X,H as Ve,J as ze,K as Je,aj as qe,ak as Ke,O as Ye,G as We,al as Xe,a0 as y,k as Ze,am as Qe,an as et,ao as tt}from"../chunks/FTlQNedl.js";import{p as at}from"../chunks/B9l1RHVT.js";import{I as st,t as lt}from"../chunks/DORw01e3.js";import{D as nt}from"../chunks/CYFWRQLF.js";import{S as ot}from"../chunks/BKVzOIvg.js";import{b as rt}from"../chunks/CHBWxhb-.js";import{m as it}from"../chunks/BxtrYP92.js";const ct=!1,dt=!0;function ut(t){return["edit","info","file","settings","loading","error","browser","about","upload","presets"].includes(t)}const ft=({url:t})=>{const e=t.searchParams.get("path");if(e){const a=decodeURIComponent(e);ut(a.replace(/^\//,""))?ue(`${ye}${a}`):(console.warn(`Invalid path: ${a}, redirecting to base path ${ye}`),ue(ye))}},Wa=Object.freeze(Object.defineProperty({__proto__:null,load:ft,prerender:dt,ssr:ct},Symbol.toStringTag,{value:"Module"}));function pt(t,e){const a=oe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v2"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M10.29 10.7a2.43 2.43 0 0 0-2.66-.52c-.29.12-.56.3-.78.53l-.35.34-.35-.34a2.43 2.43 0 0 0-2.65-.53c-.3.12-.56.3-.79.53-.95.94-1 2.53.2 3.74L6.5 18l3.6-3.55c1.2-1.21 1.14-2.8.19-3.74Z"}]];ie(t,re({name:"file-heart"},()=>a,{get iconNode(){return l},children:(s,o)=>{var r=B(),i=H(r);ce(i,e,"default",{},null),d(s,r)},$$slots:{default:!0}}))}function vt(t,e){const a=oe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}]];ie(t,re({name:"file"},()=>a,{get iconNode(){return l},children:(s,o)=>{var r=B(),i=H(r);ce(i,e,"default",{},null),d(s,r)},$$slots:{default:!0}}))}function gt(t,e){const a=oe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"}],["path",{d:"M15 5.764v15"}],["path",{d:"M9 3.236v15"}]];ie(t,re({name:"map"},()=>a,{get iconNode(){return l},children:(s,o)=>{var r=B(),i=H(r);ce(i,e,"default",{},null),d(s,r)},$$slots:{default:!0}}))}function ht(t,e){const a=oe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];ie(t,re({name:"pencil"},()=>a,{get iconNode(){return l},children:(s,o)=>{var r=B(),i=H(r);ce(i,e,"default",{},null),d(s,r)},$$slots:{default:!0}}))}function _t(t,e){const a=oe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];ie(t,re({name:"settings"},()=>a,{get iconNode(){return l},children:(s,o)=>{var r=B(),i=H(r);ce(i,e,"default",{},null),d(s,r)},$$slots:{default:!0}}))}const[Te,yt,Xa]=Oe({parent:"none",value:"",expanded:!1});var mt=P('<nav data-testid="nav-bar-tileset"><!></nav>'),St=P('<aside data-testid="nav-bar"><!></aside>');function bt(t,e){Z(e,!0);const a=n(e,"base",3,"flex flex-col"),l=n(e,"background",3,"preset-filled-surface-100-900"),s=n(e,"width",3,"min-w-[320px] w-full"),o=n(e,"height",3,"h-20"),r=n(e,"padding",3,"p-1"),i=n(e,"classes",3,""),u=n(e,"tilesBase",3,"flex-1 flex"),G=n(e,"tilesFlexDirection",3,""),E=n(e,"tilesJustify",3,"justify-center"),w=n(e,"tilesItems",3,"items-center"),v=n(e,"tilesGap",3,"gap-1"),T=n(e,"tilesClasses",3,"");Te({parent:"bar",get value(){return e.value},expanded:!1,get onValueChange(){return e.onValueChange}});var g=St(),L=U(g);{var m=h=>{var D=mt(),N=U(D);ae(N,()=>e.children),b(D),z(()=>J(D,1,`${u()??""} ${G()??""} ${E()??""} ${w()??""} ${v()??""} ${T()??""}`)),d(h,D)};R(L,h=>{e.children&&h(m)})}b(g),z(()=>J(g,1,`${a()??""} ${l()??""} ${s()??""} ${o()??""} ${r()??""} ${i()??""}`)),d(t,g),Q()}var Pt=P('<header data-testid="nav-rail-header"><!></header>'),xt=P('<nav data-testid="nav-rail-tiles"><!></nav>'),Et=P('<footer data-testid="nav-rail-footer"><!></footer>'),wt=P('<aside data-testid="nav-rail"><!> <!> <!></aside>');function Pe(t,e){Z(e,!0);const a=n(e,"value",3,""),l=n(e,"expanded",3,!1),s=n(e,"base",3,"h-full flex flex-col"),o=n(e,"background",3,"preset-filled-surface-100-900"),r=n(e,"padding",3,"p-1"),i=n(e,"width",3,"w-24"),u=n(e,"widthExpanded",3,"w-64"),G=n(e,"height",3,"h-full"),E=n(e,"classes",3,""),w=n(e,"headerBase",3,"flex"),v=n(e,"headerFlexDirection",3,"flex-col"),T=n(e,"headerJustify",3,"justify-center"),g=n(e,"headerItems",3,"items-center"),L=n(e,"headerGap",3,"gap-1"),m=n(e,"headerClasses",3,""),h=n(e,"tilesBase",3,"flex-1 flex"),D=n(e,"tilesFlexDirection",3,"flex-col"),N=n(e,"tilesJustify",3,"justify-center"),q=n(e,"tilesItems",3,"items-center"),ee=n(e,"tilesGap",3,"gap-1"),p=n(e,"tilesClasses",3,""),f=n(e,"footerBase",3,"flex"),_=n(e,"footerFlexDirection",3,"flex-col"),k=n(e,"footerJustify",3,"justify-center"),K=n(e,"footerItems",3,"items-center"),Y=n(e,"footerGap",3,"gap-1"),se=n(e,"footerClasses",3,"");Te({parent:"rail",get value(){return a()},get expanded(){return l()},get onValueChange(){return e.onValueChange}});let pe=V(()=>l()?u():i());var te=wt(),de=U(te);{var ve=O=>{var S=Pt(),W=U(S);ae(W,()=>e.header),b(S),z(()=>J(S,1,`${w()??""} ${v()??""} ${T()??""} ${g()??""} ${L()??""} ${m()??""}`)),d(O,S)};R(de,O=>{e.header&&O(ve)})}var le=C(de,2);{var ge=O=>{var S=xt(),W=U(S);ae(W,()=>e.tiles),b(S),z(()=>J(S,1,`${h()??""} ${D()??""} ${N()??""} ${q()??""} ${ee()??""} ${p()??""}`)),d(O,S)};R(le,O=>{e.tiles&&O(ge)})}var he=C(le,2);{var _e=O=>{var S=Et(),W=U(S);ae(W,()=>e.footer),b(S),z(()=>J(S,1,`${f()??""} ${_()??""} ${k()??""} ${K()??""} ${Y()??""} ${se()??""}`)),d(O,S)};R(he,O=>{e.footer&&O(_e)})}b(te),z(()=>J(te,1,`${s()??""} ${o()??""} ${G()??""} ${r()??""} ${M(pe)??""} ${E()??""}`)),d(t,te),Q()}var Tt=P("<div><!></div>"),Dt=P('<div data-testid="nav-tile-label"> </div>'),Ct=P('<div data-testid="nav-tile-label-expanded"> </div>'),Ut=P("<!> <!> <!>",1);function At(t,e){const a=Ae();Z(e,!0);const l=n(e,"id",3,a),s=n(e,"selected",3,void 0),o=n(e,"type",3,"button"),r=n(e,"base",3,"flex items-center"),i=n(e,"width",3,"w-full"),u=n(e,"aspect",3,"aspect-square"),G=n(e,"background",3,""),E=n(e,"hover",3,"hover:preset-filled-surface-50-950"),w=n(e,"active",3,"preset-filled-primary-500"),v=n(e,"padding",3,"p-2"),T=n(e,"gap",3,"gap-1"),g=n(e,"rounded",3,"rounded-container"),L=n(e,"classes",3,"flex-col justify-center"),m=n(e,"expandedPadding",3,"py-3 px-4"),h=n(e,"expandedGap",3,"gap-4"),D=n(e,"expandedClasses",3,""),N=n(e,"labelBase",3,"text-xs"),q=n(e,"labelClasses",3,""),ee=n(e,"labelExpandedBase",3,""),p=n(e,"labelExpandedClasses",3,""),f=yt(),_=V(()=>e.href?"a":"button"),k=V(()=>e.href?void 0:"button"),K=V(()=>f.parent==="bar"?"h-full":`${u()}`),Y=V(()=>`${M(K)} ${v()} ${T()} ${L()}`),se=V(()=>`${m()} ${h()} ${D()}`),pe=V(()=>f.expanded?M(se):M(Y)),te=V(()=>s()!==void 0?s():f.value===l()),de=V(()=>M(te)?w():`${G()} ${E()}`);function ve(){if(e.onclick&&!l())throw new Error("No ID was provided");e.onclick&&l()&&e.onclick(l()),f.onValueChange?.(l())}var le=B(),ge=H(le);Ie(ge,()=>M(_),!1,(he,_e)=>{Ge(he,()=>({class:`${r()??""} ${i()??""} ${g()??""} ${M(de)??""} ${M(pe)??""}`,href:e.href,target:e.target,type:M(_)==="button"?o():void 0,title:e.title,role:M(k),onclick:ve,tabindex:"0","data-testid":"nav-tile"}));var O=Ut(),S=H(O);{var W=F=>{var I=Tt(),ne=U(I);ae(ne,()=>e.children),b(I),d(F,I)};R(S,F=>{e.children&&F(W)})}var Se=C(S,2);{var De=F=>{var I=Dt(),ne=U(I,!0);b(I),z(()=>{J(I,1,`${N()??""} ${q()??""}`),be(ne,e.label)}),d(F,I)};R(Se,F=>{e.label&&!f.expanded&&F(De)})}var Ce=C(Se,2);{var Ue=F=>{var I=Ct(),ne=U(I,!0);b(I),z(()=>{J(I,1,`${ee()??""} ${p()??""}`),be(ne,e.labelExpanded)}),d(F,I)};R(Ce,F=>{e.labelExpanded&&f.expanded&&F(Ue)})}d(_e,O)}),d(t,le),Q()}const j=Object.assign(Pe,{Rail:Pe,Bar:bt,Tile:At});var Lt=P("<!> <!> <!> <!> <!> <!> <!>",1);function Ht(t,e){Z(e,!0);let a=fe(),l=x(),s=Ee();xe(()=>{const{id:u}=at.route;a.navigateTo(u?.replace("/",""))});async function o(){await s.showModal(Be,{title:"Settings",settings:l.settings})&&(me(c.UPDATE_SETTINGS,{...l.settings}),setTimeout(()=>{location.reload()},500))}var r=B(),i=H(r);{const u=w=>{var v=B(),T=H(v);{var g=L=>{var m=B(),h=H(m);$(h,()=>j.Tile,(D,N)=>{N(D,{label:"Save",labelBase:"text-xs",title:"Save",id:"save",onclick:()=>l.writeSave(),children:(q,ee)=>{Fe(q,{})},$$slots:{default:!0}})}),d(L,m)};R(T,L=>{l.saveFile&&Me==="true"&&L(g)})}d(w,v)},G=w=>{var v=Lt(),T=H(v);$(T,()=>j.Tile,(p,f)=>{f(p,{label:"Edit",labelBase:"text-xs",title:"Edit",id:"edit",href:"/edit",active:"bg-secondary-500",children:(_,k)=>{ht(_,{})},$$slots:{default:!0}})});var g=C(T,2);{var L=p=>{var f=B(),_=H(f);$(_,()=>j.Tile,(k,K)=>{K(k,{label:"Files",labelBase:"text-xs",title:"File",id:"file",href:"/file",active:"bg-secondary-500",children:(Y,se)=>{vt(Y,{})},$$slots:{default:!0}})}),d(p,f)};R(g,p=>{p(L)})}var m=C(g,2);$(m,()=>j.Tile,(p,f)=>{f(p,{label:"Map",labelBase:"text-xs",title:"Map",id:"map",href:"/worldmap",active:"bg-secondary-500",children:(_,k)=>{gt(_,{})},$$slots:{default:!0}})});var h=C(m,2);$(h,()=>j.Tile,(p,f)=>{f(p,{label:"About",labelBase:"text-xs",title:"About",id:"about",href:"/about",active:"bg-secondary-500",children:(_,k)=>{st(_,{})},$$slots:{default:!0}})});var D=C(h,2);$(D,()=>j.Tile,(p,f)=>{f(p,{label:"Presets",labelBase:"text-xs",title:"Presets",id:"presets",href:"/presets",active:"bg-secondary-500",children:(_,k)=>{pt(_,{})},$$slots:{default:!0}})});var N=C(D,2);$(N,()=>j.Tile,(p,f)=>{f(p,{label:"UPS",labelBase:"text-xs",title:"Universal Pal Storage",id:"ups",href:"/ups",active:"bg-secondary-500",children:(_,k)=>{nt(_,{})},$$slots:{default:!0}})});var q=C(N,2);{var ee=p=>{var f=B(),_=H(f);$(_,()=>j.Tile,(k,K)=>{K(k,{label:"Debug",labelBase:"text-xs",title:"Debug",id:"debug",href:"/debug",active:"bg-secondary-500",children:(Y,se)=>{Re(Y,{})},$$slots:{default:!0}})}),d(p,f)};R(q,p=>{l.settings.debug_mode&&p(ee)})}d(w,v)},E=w=>{var v=B(),T=H(v);$(T,()=>j.Tile,(g,L)=>{L(g,{label:"Settings",labelBase:"text-xs",title:"Settings",id:"settings",onclick:o,children:(m,h)=>{_t(m,{})},$$slots:{default:!0}})}),d(w,v)};$(i,()=>j.Rail,(w,v)=>{v(w,{width:"48px",get value(){return a.activePage},onValueChange:T=>a.navigateToAndSave(T),header:u,tiles:G,footer:E,$$slots:{header:!0,tiles:!0,footer:!0}})})}d(t,r),Q()}var Ot=P("<div></div>");function It(t,e){Z(e,!0);let a=n(e,"position",3,"top-right"),l=n(e,"transition",19,()=>({type:"fly",params:{x:300}}));const s=A();xe(()=>{s.setPosition(a()),s.setTransition(l())});let o=V(()=>({"top-center":"top-4 left-1/2 transform -translate-x-1/2","top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4","bottom-center":"bottom-4 left-1/2 transform -translate-x-1/2"})[s.position]);var r=Ot();$e(r,21,()=>s.toasts,i=>i.id,(i,u)=>{je(i,{get toast(){return M(u)}})}),b(r),z(()=>J(r,1,`toast-content fixed flex flex-col gap-2 ${M(o)??""}`,"svelte-1smmv0i")),d(t,r),Q()}const Gt=async()=>{await we.reset(),await X.reset(),await Ve.reset(),await ze.reset(),await lt.reset(),await Je.reset(),await qe.reset(),await Ke.reset(),await Ye.reset(),await We.reset(),await rt.reset(),await it.reset(),await Xe.reset(),await y().loadAll(),me(c.GET_VERSION),me(c.SYNC_APP_STATE)};function Nt(t,e){e.closeModal(null)}var kt=P('<div class="flex flex-col space-y-4 p-4"><h3 class="h3">Update Available!</h3> <p class="my-4">A new version of Palworld Save Pal is available on GitHub.</p> <div class="mt-2 flex flex-row items-center justify-end space-x-2"><a href="https://github.com/oMaN-Rod/palworld-save-pal/releases" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Update Now</a> <button class="btn hover:bg-secondary-500">Later</button></div></div>'),Mt=P('<div class="flex h-full w-full flex-col items-center justify-center space-y-4"><!></div>');function Bt(t,e){Z(e,!0);var a=Mt(),l=U(a);Ze(l,{class:"min-w-[calc(100vw/3)]",children:(s,o)=>{var r=kt(),i=C(U(r),4),u=C(U(i),2);u.__click=[Nt,e],b(i),b(r),d(s,r)},$$slots:{default:!0}}),b(a),d(t,a),Q()}Le(["click"]);async function Ft(t){try{const e=await fetch("https://api.github.com/repos/oMaN-Rod/palworld-save-pal/releases/latest");if(!e.ok)throw new Error(`GitHub API error: ${e.status} ${e.statusText}`);const l=(await e.json()).tag_name.replace(/^v/,""),s=t.replace(/^v/,"");return Rt(l,s)}catch(e){const a=e instanceof Error?e.message:String(e);throw new Error(`Failed to check for updates: ${a}`)}}function Rt(t,e){const a=t.split(".").map(o=>parseInt(o)||0),l=e.split(".").map(o=>parseInt(o)||0),s=Math.max(a.length,l.length);for(;a.length<s;)a.push(0);for(;l.length<s;)l.push(0);for(let o=0;o<s;o++){if(a[o]>l[o])return!0;if(a[o]<l[o])return!1}return!1}const $t={type:c.PROGRESS_MESSAGE,async handle(t){const e=x();e.progressMessage=t}},jt={type:c.GET_VERSION,async handle(t){const e=x(),a=Ee();e.version=t,await Ft(t)&&await a.showModal(Bt,{})}},Vt={type:c.ERROR,async handle(t){const e=t;ue("/error",{state:{message:e.message,trace:e.trace}})}},zt={type:c.GET_SETTINGS,async handle(t){const e=x();e.settings=t}},Jt=[jt,$t,Vt,zt],qt={type:c.GET_GPS_PALS,async handle(t,{goto:e}){const a=x();a.gps=t}},Kt={type:c.ADD_GPS_PAL,async handle(t){const{pal:e,index:a}=t,l=x(),s=fe();if(e){if(l.gps){const o=X.pals[e.character_key];e.name=o?.localized_name||e.character_id,e.elements=o?.element_types||[],l.gps&&(l.gps[a]=e)}l.selectedPal=e,s.activeTab="pal"}}},Yt=[qt,Kt],Wt={type:c.GET_GUILDS,async handle(t,{goto:e}){const a=x(),l=await Promise.all(Object.entries(t).map(async([s,o])=>{try{return o.bases&&await Promise.all(Object.values(o.bases).map(async r=>{r.pals&&await Promise.all(Object.values(r.pals).map(async i=>{const u=X.getByKey(i.character_key);u||console.error("Failed to find pal info for",JSON.parse(JSON.stringify(i))),i.name=u?.localized_name||i.character_id}))})),[s,o]}catch(r){return console.error(`Failed to parse guild data for key ${s}:`,r),null}}));a.guilds=Object.fromEntries(l.filter(s=>s!==null)),console.log(`Loaded ${Object.keys(a.guilds).length} guilds`),await e("/edit")}},Xt={type:c.DELETE_GUILD,async handle(t,{goto:e}){const a=x(),l=A();console.log(`Deleting guild ${JSON.stringify(t)}`);const{guild_id:s,origin:o}=t;a.selectedPlayer=void 0,a.selectedPal=void 0;const r=a.guilds[s],i=r?.name||"Unknown Guild";a.players=Object.fromEntries(Object.entries(a.players).filter(([u])=>r.players?.includes(u)!==!0)),delete a.guilds[s],l.add(`Guild ${i} deleted`,void 0,"success"),await e(`/${o}`)}},Zt=[Xt,Wt],Qt={type:c.ADD_PAL,async handle(t){const{player_id:e,guild_id:a,base_id:l,pal:s}=t,o=x(),r=fe();if(s){if(e&&o.players){const i=X.getByKey(s.character_key);s.name=i?.localized_name||s.character_id,s.elements=i?.element_types||[],o.players[e].pals[s.instance_id]=s}if(a&&o.guilds){const i=X.getByKey(s.character_key);s.name=i?.localized_name||s.character_id,s.elements=i?.element_types||[],o.guilds[a].bases[l].pals[s.instance_id]=s}o.selectedPal=s,r.activeTab="pal"}}},ea={type:c.ADD_DPS_PAL,async handle(t){const{player_id:e,pal:a,index:l}=t,s=x(),o=fe();if(a){if(e&&s.players){const r=X.getByKey(a.character_key);a.name=r?.localized_name||a.character_id,a.elements=r?.element_types||[],s.players[e].dps&&(s.players[e].dps[l]=a)}s.selectedPal=a,o.activeTab="pal"}}},ta={type:c.MOVE_PAL,async handle(t){const e=x(),a=t;if(e.players&&e.players[a.player_id]){const l=e.players[a.player_id],s=l.pals?l.pals[a.pal_id]:void 0;s&&(s.storage_id=a.container_id,s.storage_slot=a.slot_index)}}},aa=[Qt,ta,ea],sa={type:c.GET_PLAYERS,async handle(t){const e=x(),a=await Promise.all(Object.entries(t).map(async([l,s])=>{try{return s.pals&&Object.values(s.pals).map(o=>{const r=X.getByKey(o.character_key);r||console.error("Failed to find pal info for",JSON.parse(JSON.stringify(o))),o.name=r?.localized_name||o.character_id}),[l,s]}catch(o){return console.error(`Failed to parse player data for key ${l}:`,o),null}}));e.players=Object.fromEntries(a.filter(l=>l!==null))}},la={type:c.DELETE_PLAYER,async handle(t,{goto:e}){const a=x(),l=A(),{player_id:s,origin:o}=t;if(!t){l.add("Cannot delete guild admin player, you must delete the entire guild or transfer admin to another player","Error","error");return}a.selectedPlayer=void 0,a.selectedPal=void 0;const r=a.players[s]?.nickname||"Unknown Player";delete a.players[s],Object.values(a.guilds).forEach(i=>{i.players=i.players.filter(u=>u!==s)}),l.add(`Player ${r} deleted`,void 0,"success"),e(`/${o}`)}},na=[la,sa],oa={type:c.EXPORT_PRESET,async handle(t){A().add(t.message,"Export Success","success")}},ra={type:c.IMPORT_PRESET,async handle(t){A().add(t.message,"Import Success","success"),await we.reset()}},ia=[oa,ra],ca={type:c.NO_FILE_SELECTED,async handle(t,{goto:e}){A().add("No file was selected","Warning","warning"),await e("/file")}},da={type:c.LOADED_SAVE_FILES,async handle(t){const e=x(),{level:a,players:l,world_name:s,size:o,type:r}=t;console.log("Loaded save files",a,l),e.resetState(),e.saveFile={name:a,world_name:s,type:r},e.playerSaveFiles=l.map(i=>({name:i}))}},ua={type:c.SAVE_MODDED_SAVE,async handle(t,{goto:e}){A().add(t,"Saved!","success"),await e("/file")}},fa={type:c.DOWNLOAD_SAVE_FILE,async handle(t,{goto:e}){console.log("Download save files",t);const a=t;for(const{name:l,content:s}of a){const o=atob(s),r=new Uint8Array(o.length);for(let E=0;E<o.length;E++)r[E]=o.charCodeAt(E);const i=new Blob([r],{type:"application/octet-stream"}),u=URL.createObjectURL(i),G=document.createElement("a");G.href=u,G.download=l,G.click(),URL.revokeObjectURL(u)}await e("/file")}},pa={type:c.UPDATE_SAVE_FILE,async handle(t){const e=x();console.log("Save file updated",t),await new Promise(a=>setTimeout(a,500)),e.autoSave=!1}},va={type:c.SELECT_GAMEPASS_SAVE,async handle(t,{goto:e}){const a=x();a.resetState(),a.gamepassSaves=t,await e("/file")}},ga=[da,ua,fa,pa,ca,va],ha={type:c.GET_UPS_PALS,async handle(t){y().setPalsData(t.pals,t.total_count,t.offset,t.limit)}},_a={type:c.GET_UPS_ALL_FILTERED_IDS,async handle(t){const e=y();t.pal_ids.forEach(a=>e.selectedPals.add(a)),e.selectedPals=new Set(e.selectedPals)}},ya={type:c.ADD_UPS_PAL,async handle(t){const e=y();t.pal&&(e.pals=[t.pal,...e.pals],e.pagination.totalCount++,await e.loadCollections())}},ma={type:c.UPDATE_UPS_PAL,async handle(t){const e=y();if(t.pal&&t.pal.id){const a=e.pals.findIndex(l=>l.id===t.pal.id);if(a>=0){const l="collection_id"in t.pal&&t.pal.collection_id!==e.pals[a].collection_id;Object.assign(e.pals[a],t.pal),l&&await e.loadCollections()}}}},Sa={type:c.DELETE_UPS_PALS,async handle(t){const e=y(),a=A();t.deleted_count>0?(await e.loadPals(!0),await e.loadCollections(),t.deleted_count===t.requested_count?a.add(`Deleted ${t.deleted_count} pal${t.deleted_count>1?"s":""}`,"Success","success"):a.add(`Deleted ${t.deleted_count} of ${t.requested_count} requested pals`,"Partial","warning")):a.add("No pals were deleted","Error","error")}},ba={type:c.CLONE_UPS_PAL,async handle(t){const e=y();t.cloned_pal&&(e.pals=[t.cloned_pal,...e.pals],e.pagination.totalCount++,await e.loadCollections())}},Pa={type:c.EXPORT_UPS_PAL,async handle(t){if(t.success){let e=`Exported pal to ${t.destination_type.toUpperCase()}`;t.destination_slot!==void 0&&(e+=` slot ${t.destination_slot}`)}}},xa={type:c.CLONE_TO_UPS,async handle(t){const e=y(),a=A();if(t.success&&t.cloned_count>0)await e.loadPals(!0),await e.loadCollections(),await e.loadStats(),t.cloned_count===t.total_requested?a.add(`Successfully cloned ${t.cloned_count} pal${t.cloned_count>1?"s":""} to UPS`,"Success","success"):a.add(`Cloned ${t.cloned_count} of ${t.total_requested} pals to UPS${t.errors?`. Errors: ${t.errors.length}`:""}`,"Partial","warning");else{const l=t.errors&&t.errors.length>0?`Clone failed: ${t.errors[0]}${t.errors.length>1?` (and ${t.errors.length-1} more)`:""}`:"Clone to UPS failed";a.add(l,"Error","error")}}},Ea={type:c.IMPORT_TO_UPS,async handle(t){const e=y(),a=A();t.success&&t.pal?(e.pals=[t.pal,...e.pals],e.pagination.totalCount++,await e.loadCollections()):a.add(`Import failed: ${t.error||"Unknown error"}`,"Error","error")}},wa={type:c.GET_UPS_COLLECTIONS,async handle(t){y().setCollections(t.collections)}},Ta={type:c.CREATE_UPS_COLLECTION,async handle(t){const e=y(),a=A();t.collection&&(e.collections=[...e.collections,t.collection],a.add(`Created collection "${t.collection.name}"`,"Success","success"))}},Da={type:c.UPDATE_UPS_COLLECTION,async handle(t){const e=y(),a=A();if(t.collection){const l=e.collections.findIndex(s=>s.id===t.collection.id);l>=0&&(e.collections[l]=t.collection,a.add(`Updated collection "${t.collection.name}"`,"Success","success"))}}},Ca={type:c.DELETE_UPS_COLLECTION,async handle(t){const e=y(),a=A();if(t.success){const l=e.collections.find(s=>s.id===t.collection_id);e.collections=e.collections.filter(s=>s.id!==t.collection_id),e.filters.collectionId===t.collection_id&&(e.filters.collectionId=void 0),a.add(`Deleted collection ${l?`"${l.name}"`:""}`,"Success","success")}else a.add("Failed to delete collection","Error","error")}},Ua={type:c.GET_UPS_TAGS,async handle(t){y().setTags(t.tags)}},Aa={type:c.CREATE_UPS_TAG,async handle(t){const e=y(),a=A();if(t.tag){const l=e.tags.findIndex(s=>s.id===t.tag.id);l>=0?e.tags[l]=t.tag:e.tags=[...e.tags,t.tag],a.add(`Created tag "${t.tag.name}"`,"Success","success")}}},La={type:c.UPDATE_UPS_TAG,async handle(t){const e=y(),a=A();if(t.tag){const l=e.tags.findIndex(s=>s.id===t.tag.id);l>=0&&(e.tags[l]=t.tag),a.add(`Updated tag "${t.tag.name}"`,"Success","success")}}},Ha={type:c.DELETE_UPS_TAG,async handle(t){const e=y(),a=A();if(t.success){const l=e.tags.find(s=>s.id===t.tag_id);e.tags=e.tags.filter(s=>s.id!==t.tag_id),l&&a.add(`Deleted tag "${l.name}"`,"Success","success")}}},Oa={type:c.GET_UPS_STATS,async handle(t){y().setStats(t.stats)}},Ia=[ha,_a,ya,ma,Sa,ba,xa,Pa,Ea,wa,Ta,Da,Ca,Ua,Aa,La,Ha,Oa],Ga=[...Jt,...ga,...aa,...na,...Zt,...ia,...Yt,...Ia];var Na=P('<div class="absolute right-2 top-1 flex shrink-0 flex-row"><div class="flex items-center space-x-2 rounded-full p-3"><span class="text-lg font-bold">Syncing</span> <!></div></div>'),ka=P('<div class="flex h-screen w-full overflow-hidden"><!> <!> <main class="flex-1 overflow-hidden"><!></main></div>'),Ma=P("<!> <!>",1);function Za(t,e){Z(e,!0);const a=tt(),l=Qe(),s=x();Ga.forEach(u=>{l.register(u)}),He(async()=>{a.connect({goto:ue}),await Gt()});var o=Ma(),r=H(o);It(r,{position:"bottom-center",transition:{type:"fly",params:{y:300}}});var i=C(r,2);et(i,{children:(u,G)=>{var E=ka(),w=U(E);Ht(w,{});var v=C(w,2);{var T=m=>{var h=Na(),D=U(h),N=C(U(D),2);ot(N,{size:"size-6"}),b(D),b(h),Ne(3,h,()=>ke),d(m,h)};R(v,m=>{s.autoSave&&m(T)})}var g=C(v,2),L=U(g);ae(L,()=>e.children),b(g),b(E),d(u,E)},$$slots:{default:!0}}),d(t,o),Q()}export{Za as component,Wa as universal};
